<!DOCTYPE html>
<html lang="en">
<head>
    <title>netjsongraph.js: basic example</title>
    <meta charset="utf-8">
    <!-- theme can be easily customized via css -->
    <link href="../src/css/netjsongraph-theme.css" rel="stylesheet">
    <link href="../src/css/netjsongraph.css" rel="stylesheet">
</head>
<body>
    <script type="text/javascript" src="../dist/netjsongraph.min.js"></script>
    <script type="text/javascript">
        const graph = new NetJSONGraph("./data/netjsongraph-foldNodes.json", {
          render: graphRender,
          dealDataByWorker: "../src/js/netjsonWorker.js",
      });

      graph.setConfig({
          onClickElement: onClickElement.bind(graph),
      });

      graph.render();

      function onClickElement(type, data){
          // present element info overlay
          let nodeLinkOverlay = document.getElementsByClassName("njg-overlay")[0];
          
          nodeLinkOverlay.style.visibility = "visible";
          nodeLinkOverlay.innerHTML = `
              <div class="njg-inner">
                  ${
                  type === "link"
                      ? this.utils.linkInfo(data)
                      : this.utils.nodeInfo(data)
                  }
              </div>
          `;

          const closeA = document.createElement("a");
          closeA.setAttribute("class", "njg-close");
          closeA.setAttribute("id", "nodelinkOverlay-close");
          closeA.onclick = () => {
              nodeLinkOverlay.style.visibility = "hidden";
          };

          nodeLinkOverlay.appendChild(closeA);

          // expand or fold nodes
          if(type === "node" && data.childNodes){
              let JSONData = this.data;

              if(!data._expanded){
                  data.childNodes.map(child => {
                      JSONData.flatNodes[child.id] = child;
                      JSONData.nodes.push(child);
                      JSONData.links.push({
                          source: data.id,
                          target: child.id
                      });
                      child.category = data.category;
                  })

                  JSONData.flatNodes[data.id]._expanded = true;
              }
              else{
                  data.childNodes.map(child => {
                      let node = JSONData.flatNodes[child.id],
                          index = JSONData.nodes.indexOf(node);
                      
                      JSONData.nodes.splice(index, 1);
                      delete JSONData.flatNodes[child.id];
                  })

                  JSONData.flatNodes[data.id]._expanded = false;
              }

              graph.echarts.setOption(generateGraphOption(JSONData, graph));
          }
      }
    </script>
</html>
